{"ast":null,"code":"import _regeneratorRuntime from\"/Users/user/Documents/frontend/react-sneakers/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/user/Documents/frontend/react-sneakers/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/user/Documents/frontend/react-sneakers/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import axios from\"axios\";import styles from\"./Drawer.module.scss\";import Info from\"../Info\";import AppContext from\"../../context.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var delay=function delay(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};function Drawer(_ref){var onCloseCart=_ref.onCloseCart,onRemove=_ref.onRemove,_ref$items=_ref.items,items=_ref$items===void 0?[]:_ref$items,opened=_ref.opened;var _React$useContext=React.useContext(AppContext),cartItems=_React$useContext.cartItems,setCartItems=_React$useContext.setCartItems;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isOrderComplete=_React$useState2[0],setIsOrderComplete=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),orderId=_React$useState4[0],setOrderId=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isLoading=_React$useState6[0],setIsLoading=_React$useState6[1];var totalPrice=cartItems.reduce(function(sum,obj){return sum+obj.price;},0);var onClickOrder=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios$post,data,i,item;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setIsLoading(true);_context.next=4;return axios.post(\"https://6387382ad9b24b1be3e9cb49.mockapi.io/orders\",{items:cartItems});case 4:_yield$axios$post=_context.sent;data=_yield$axios$post.data;setOrderId(data.id);setIsOrderComplete(true);setCartItems([]);i=0;case 10:if(!(i<cartItems.length)){_context.next=19;break;}item=cartItems[i];_context.next=14;return axios.delete(\"https://6387382ad9b24b1be3e9cb49.mockapi.io/cart/\"+item.id);case 14:_context.next=16;return delay(1000);case 16:i++;_context.next=10;break;case 19:_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](0);alert('Не удлось создать заказ :(');case 24:setIsLoading(false);case 25:case\"end\":return _context.stop();}}},_callee,null,[[0,21]]);}));return function onClickOrder(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(styles.overlay,\" \").concat(opened?styles.overlayVisible:''),children:/*#__PURE__*/_jsxs(\"div\",{className:styles.drawer,children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"mb-30 d-flex justify-between align-center\",children:[\"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\",/*#__PURE__*/_jsx(\"img\",{className:\"cu-p\",src:\"/img/drawer/btn-remove.svg\",alt:\"Remove\",onClick:onCloseCart})]}),items.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"items flex\",children:items.map(function(obj){return/*#__PURE__*/_jsxs(\"div\",{className:\"cartItem d-flex align-center mb-20\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cartItemImg\",style:{backgroundImage:\"url(\".concat(obj.imgUrl,\")\")}}),/*#__PURE__*/_jsxs(\"div\",{className:\"mr-12 flex\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"mb-5\",children:obj.title}),/*#__PURE__*/_jsxs(\"b\",{children:[obj.price,\" \\u0440\\u0443\\u0431.\"]})]}),/*#__PURE__*/_jsx(\"img\",{className:\"removeBtn\",onClick:function onClick(){return onRemove(obj.id);},src:\"/img/drawer/btn-remove.svg\",alt:\"Remove\"})]},obj.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cartTotalBlock\",children:[/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0418\\u0442\\u043E\\u0433\\u043E:\"}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"b\",{children:[totalPrice,\" \\u0440\\u0443\\u0431.\"]})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041D\\u0430\\u043B\\u043E\\u0433 5%: \"}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"b\",{children:[Math.round(totalPrice/100*5),\" \\u0440\\u0443\\u0431.\"]})]})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"greenButton\",onClick:onClickOrder,disabled:isLoading,children:[\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u0438\\u0442\\u044C \\u0437\\u0430\\u043A\\u0430\\u0437\",/*#__PURE__*/_jsx(\"img\",{src:\"/img/drawer/arrow.svg\"})]})]})]}):/*#__PURE__*/_jsx(Info,{title:isOrderComplete?\"Заказ оформлен!\":\"Корзина пустая\",description:isOrderComplete?\"\\u0412\\u0430\\u0448 \\u0437\\u0430\\u043A\\u0430\\u0437 #\".concat(orderId,\" \\u0441\\u043A\\u043E\\u0440\\u043E \\u0431\\u0443\\u0434\\u0435\\u0442 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D \\u043A\\u0443\\u0440\\u044C\\u0435\\u0440\\u0441\\u043A\\u043E\\u0439 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0435\"):\"Добавьте хотя бы одну пару кроссовок, чтобы сделать заказ.\",image:isOrderComplete?\"/img/drawer/complete-order.png\":\"/img/drawer/empty-cart.jpeg\"})]})});}export default Drawer;","map":{"version":3,"names":["React","axios","styles","Info","AppContext","delay","ms","Promise","resolve","setTimeout","Drawer","onCloseCart","onRemove","items","opened","useContext","cartItems","setCartItems","useState","isOrderComplete","setIsOrderComplete","orderId","setOrderId","isLoading","setIsLoading","totalPrice","reduce","sum","obj","price","onClickOrder","post","data","id","i","length","item","delete","alert","overlay","overlayVisible","drawer","map","backgroundImage","imgUrl","title","Math","round"],"sources":["/Users/user/Documents/frontend/react-sneakers/src/components/Drawer/Index.jsx"],"sourcesContent":["import React from \"react\";\nimport axios from \"axios\";\n\nimport styles from \"./Drawer.module.scss\";\n\nimport Info from \"../Info\";\nimport AppContext from \"../../context.js\";\n\nconst delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\nfunction Drawer({onCloseCart, onRemove, items = [], opened}) {\n  const {cartItems, setCartItems} = React.useContext(AppContext);\n  const [isOrderComplete, setIsOrderComplete] = React.useState(false);\n  const [orderId, setOrderId] = React.useState(null);\n  const [isLoading, setIsLoading] = React.useState(false);\n\n  const totalPrice = cartItems.reduce((sum, obj) => sum + obj.price, 0);\n\n  const onClickOrder = async () => {\n    try{\n      setIsLoading(true);\n      const{data} = await axios.post(`https://6387382ad9b24b1be3e9cb49.mockapi.io/orders`, {\n        items : cartItems,\n      });\n      setOrderId(data.id)\n      setIsOrderComplete(true);\n      setCartItems([]);  \n      for (let i = 0; i < cartItems.length; i++) {\n        const item = cartItems[i];\n        await axios.delete(`https://6387382ad9b24b1be3e9cb49.mockapi.io/cart/` + item.id);\n        await delay(1000);\n      }\n    } catch (error){\n      alert('Не удлось создать заказ :(')\n    }\n    setIsLoading(false);\n  }\n\n  return (\n    <div className={`${styles.overlay} ${opened ? styles.overlayVisible : ''}`}>\n      <div className={styles.drawer}>\n      <h2 className=\"mb-30 d-flex justify-between align-center\">\n        Корзина\n        <img \n          className=\"cu-p\" \n          src=\"/img/drawer/btn-remove.svg\" \n          alt=\"Remove\" \n          onClick={onCloseCart}\n          />\n      </h2>\n      {\n        items.length > 0 ? \n        (<>\n          <div className=\"items flex\">\n            {items.map((obj) => (\n              <div key={obj.id} className=\"cartItem d-flex align-center mb-20\">\n                <div className=\"cartItemImg\" style={{ backgroundImage: `url(${obj.imgUrl})` }}>\n                </div>\n                <div className=\"mr-12 flex\">\n                  <p className=\"mb-5\">{obj.title}</p>\n                  <b>{obj.price} руб.</b>\n                </div>\n                <img className=\"removeBtn\" onClick={() => onRemove(obj.id)} src=\"/img/drawer/btn-remove.svg\" alt=\"Remove\" />\n              </div>\n            ))}\n          </div>\n          <div className=\"cartTotalBlock\">\n            <ul>\n              <li>\n                <span>Итого:</span>\n                <div></div>\n                <b>{totalPrice} руб.</b>\n              </li>\n              <li>\n                <span>Налог 5%: </span>\n                <div></div>\n                <b>{Math.round(totalPrice / 100 * 5)} руб.</b>\n              </li>\n            </ul>\n            <button className=\"greenButton\" onClick={onClickOrder} disabled={isLoading}>\n              Оформить заказ\n              <img src=\"/img/drawer/arrow.svg\" />\n            </button>\n          </div>\n        </>)\n        : \n        (<Info \n          title={isOrderComplete ? \"Заказ оформлен!\" : \"Корзина пустая\"} \n          description={isOrderComplete ? `Ваш заказ #${orderId} скоро будет передан курьерской доставке` : \"Добавьте хотя бы одну пару кроссовок, чтобы сделать заказ.\"} \n          image={isOrderComplete ? \"/img/drawer/complete-order.png\" : \"/img/drawer/empty-cart.jpeg\"} />)\n      }      \n      </div>\n    </div>\n   );\n}\n\nexport default Drawer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}